<!DOCTYPE html>
<html>
<head>
    <title>Gray Style Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style>
        .gm-style-iw-t {
            display: none !important;
        }

        #map {
            height: 400px;
            width: 100%;
        }
        .location-info {
            display: none;
        }
        .active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <input id="search" type="text" placeholder="Search for location">
    <button id="searchBtn">Search</button> <!-- Add search button -->
    
    <!-- Divs for location info -->
    <div id="location1" class="location-info">
        Location 1 Info
        <button class="backBtn back">Back</button>
    </div>
    <div id="location2" class="location-info">
        Location 2 Info
        <button class="backBtn back">Back</button>
    </div>
    <div id="location3" class="location-info">
        Location 3 Info
        <button class="backBtn back">Back</button>
    </div>
    <div id="location4" class="location-info">
        Location 4 Info
        <button class="backBtn back">Back</button>
    </div>

    <script>
        let map;
        let markers = [];
        let locationDivs = [];
        let infowindows = [];

        function initMap() {

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 50, lng: -50 }, // Adjusted center
                zoom: 4,
                styles: [
                    {
                        elementType: "geometry",
                        stylers: [{ color: "#f5f5f5" }]
                    },
                    {
                        elementType: "labels.icon",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#858585" }]
                    },
                    {
                        elementType: "labels.text.stroke",
                        stylers: [{ color: "#f5f5f5" }]
                    },
                    {
                        featureType: "administrative.land_parcel",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#bdbdbd" }]
                    },
                    {
                        featureType: "poi",
                        elementType: "geometry",
                        stylers: [{ color: "#eeeeee" }]
                    },
                    {
                        featureType: "poi",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#757575" }]
                    },
                    {
                        featureType: "poi.park",
                        elementType: "geometry",
                        stylers: [{ color: "#e5e5e5" }]
                    },
                    {
                        featureType: "poi.park",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#9e9e9e" }]
                    },
                    {
                        featureType: "road",
                        elementType: "geometry",
                        stylers: [{ color: "#ffffff" }]
                    },
                    {
                        featureType: "road.arterial",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#757575" }]
                    },
                    {
                        featureType: "road.highway",
                        elementType: "geometry",
                        stylers: [{ color: "#dadada" }]
                    },
                    {
                        featureType: "road.highway",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#616161" }]
                    },
                    {
                        featureType: "road.local",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#9e9e9e" }]
                    },
                    {
                        featureType: "transit.line",
                        elementType: "geometry",
                        stylers: [{ color: "#e5e5e5" }]
                    },
                    {
                        featureType: "transit.station",
                        elementType: "geometry",
                        stylers: [{ color: "#eeeeee" }]
                    },
                    {
                        featureType: "water",
                        elementType: "geometry",
                        stylers: [{ color: "#ffffff" }]
                    },
                    {
                        featureType: "water",
                        elementType: "labels.text.fill",
                        stylers: [{ color: "#9e9e9e" }]
                    }
                ],
                suppressInfoWindows: true // Suppresses the default Google Maps API warning message
            });

            const locations = [
                { lat: 47.39021, lng: 8.78152 }, // Location 1: Fehraltorf, Switzerland
                { lat: 50.08416, lng: 14.4465 }, // Location 2: Prague, Czech Republic
                { lat: 3.15806, lng: 101.6997 }, // Location 3: Kuala Lumpur, Malaysia
                { lat: 47.13552, lng: 9.52247 }  // Location 4: Vaduz, Liechtenstein
            ];

            locationDivs = [
                document.getElementById("location1"),
                document.getElementById("location2"),
                document.getElementById("location3"),
                document.getElementById("location4")
            ];

            infowindows = [
                new google.maps.InfoWindow({ content: "" }),
                new google.maps.InfoWindow({ content: "" }),
                new google.maps.InfoWindow({ content: "" }),
                new google.maps.InfoWindow({ content: "" })
            ];

            // Define the default marker icon with a black color
            // const blackMarkerIcon = {
            //     url: "https://maps.gstatic.com/mapfiles/transparent.png", // URL of the custom marker image
            //     scaledSize: new google.maps.Size(48, 48), // Size of the marker icon
            // };

            // Use the default black marker icon for markers
            markers = locations.map((location, index) => {
                const marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    // icon: blackMarkerIcon // Set the icon property to the default black marker icon
                });

                marker.addListener("click", () => {
                    infowindows.forEach(infoWindow => infoWindow.close());
                    infowindows[index].open(map, marker);
                    locationDivs.forEach(div => div.classList.remove("active"));
                    locationDivs[index].classList.add("active");
                });

                return marker;
            });
            

            const searchBox = new google.maps.places.SearchBox(document.getElementById('search'));

            map.addListener('bounds_changed', function () {
                searchBox.setBounds(map.getBounds());
            });

            document.getElementById('searchBtn').addEventListener('click', searchNearestLocation);
            document.querySelectorAll('.backBtn').forEach(btn => btn.addEventListener('click', resetMap));
        }

        function searchNearestLocation() {
            const query = document.getElementById('search').value;
            const geocoder = new google.maps.Geocoder();

            geocoder.geocode({ address: query }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const userLocation = results[0].geometry.location;
                    let nearestLocationIndex = 0;
                    let shortestDistance = google.maps.geometry.spherical.computeDistanceBetween(userLocation, markers[0].getPosition());

                    // Find nearest location
                    for (let i = 1; i < markers.length; i++) {
                        const distance = google.maps.geometry.spherical.computeDistanceBetween(userLocation, markers[i].getPosition());
                        if (distance < shortestDistance) {
                            shortestDistance = distance;
                            nearestLocationIndex = i;
                        }
                    }

                    // Display nearest location
                    const nearestLocation = markers[nearestLocationIndex].getPosition();
                    map.setCenter(nearestLocation);
                    // map.setZoom(10); // Adjust zoom level as needed
                    infowindows[nearestLocationIndex].open(map, markers[nearestLocationIndex]);
                    locationDivs.forEach(div => div.classList.remove("active"));
                    locationDivs[nearestLocationIndex].classList.add("active");

                    document.getElementById('backBtn').style.display = 'block';
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        };

        function resetMap() {
            map.setCenter({ lat: 50, lng: -50 });
            map.setZoom(4);
            document.getElementById('search').value = '';
            locationDivs.forEach(div => div.classList.remove("active"));
            document.getElementById('backBtn').style.display = 'none';
        }
        
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDutfEmo4id9X02OfLW5r43rMJ9QP1PUzM&libraries=places,geometry&callback=initMap"
        async defer></script>
</body>
</html>
